package com.shoppin.ecommerce.service;

import java.time.LocalDate;
import java.time.Period;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;

import com.shoppin.ecommerce.dto.CustomerRegisterDto;
import com.shoppin.ecommerce.model.CustomerModel;
import com.shoppin.ecommerce.repo.CustomerRepository;

@Service
public class PublicService {

    private final CustomerModel customerModel;
	
	@Autowired
	CustomerRepository customerRepository;
	
	@Autowired
	PasswordEncoder passwordEncoder;

    PublicService(CustomerModel customerModel) {
        this.customerModel = customerModel;
    }

	public ResponseEntity<Object> registerNewUser(CustomerRegisterDto customer) {
		
		try {
			CustomerModel customerModel = new CustomerModel();
			
			customerModel.setEmail(customer.getEmail());
			customerModel.setPassword(passwordEncoder.encode(customer.getPassword()));
			customerModel.setFirstName(customer.getFirstName());
			customerModel.setLastName(customer.getLastName());
			customerModel.setDOB(customer.getDOB());
			customerModel.setRole(customer.getRole());
			customerModel.setAge(getAge(customer.getDOB()));
			
			return null;
		}catch(Exception e) {
			return ResponseEntity.status(500).body("Something went wrong");
		}
	}

	private int getAge(LocalDate dob) {
		LocalDate now = LocalDate.now();
		
		Period agePeriod = Period.between(dob, now);
		return agePeriod.getYears();
	}	
}
